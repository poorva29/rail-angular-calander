@model MiraiConsultMVC.Models.DoctorProfile
@{
    ViewBag.Title = "TopicDetails";
    if (Session["UserId"] != null)
    {
        Layout = "~/Views/Shared/_PatientMasterLayout.cshtml";
    }
    else
    {
        Layout = "~/Views/Shared/_AskmiraiMasterLayout.cshtml";
    }
}
@using (Html.BeginForm())
{
    <div class="custom-central-div" style="margin-top:6%">
        <div class="row-fluid">
            <div>
                <div class='row-fluid'>
                    <div class="span12">
                        <div class="doc-details-div">
                            @{
                                string qualification = ", ";
                                if (Model.qualification != null && Model.qualification.Count > 0)
                                {
                                    foreach (var q in Model.qualification)
                                    {
                                        qualification += q.Degree.Trim() + ", ";
                                    }
                                    qualification = qualification.TrimEnd(',');
                                }
                            }
                        </div>
                        <div class="inline">
                            <div class="doc-profile-title position-left">Dr. @(Model.FirstName + " " + Model.LastName) </div><div class="position-left paddig-top"> @qualification.TrimEnd(',')</div>
                        </div>
                    </div>
                </div>
                <div class="row-fluid">
                    <div class="span2">
                        <div>
                            <div class='span2'>
                                <div class="avtar img">
                                    @if (Model.Image == "\\Content\\image\\img-na.png")
                                    {
                                      <img class="doc-image-avtar" src='..\Content\image\img-na.png' />
                                    }
                                    else
                                    {
                                      <img class="doc-image-avtar" src='@Model.Image' />
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                    @if (Model.locations != null && Model.locations.Count > 0)
                    {
                       <div class="span9 hidden-phone">
                        <div class="row">
                            <div id="ClinicName" class="span5  doc-clinic-container hidden-phone doc-clinic-details cust-below-space-reduce">
                                CLINIC/ HOSPITAL ADDRESS DETAILS:
                            </div>
                            <div class="span6 hidden-phone">
                                @if (Model.locations != null && Model.locations.Count > 0)
                                {
                                    if (Convert.ToBoolean(Model.IsDocConnectUser))
                                    {
                                        <a class='pull-right btn book_appt_button' href='@Convert.ToString(ConfigurationSettings.AppSettings["DocConnectApptUrl"])@Utilities.Encrypt(Convert.ToString(Model.UserId).Trim())&frmaskmirai=1' target='_blank' onclick='bookaptclicked( "@Utilities.Encrypt(Convert.ToString(Model.UserId))")'>Book Appointment </a>
                                    }
                                    if (Convert.ToBoolean(Model.IsDocConnectUser) == false)
                                    {
                                        <a class='pull-right btn book_appt_button' onclick="ViewProfile(@Model.UserId)">Book Appointment </a>
                                    }
                                }
                            </div>
                        </div>
                        <div class=" hidden-phone">
                            @if (Model.locations != null && Model.locations.Count > 0)
                            {
                                int count = 1;
                                <div class="row">
                                    @foreach (var location in Model.locations)
                                    {
                                        if (count % 2 == 0)
                                        {
                                            <div class="span5 left doc-clinic-container" style="margin-left: 0;">
                                                <div class="span12 doc-div-min-height margin-null">
                                                    <div class="left loc-label doc-div-min-height span4"> Clinic Name:</div>
                                                    <div class="span7 doc-div-min-height left doc-detail-word-break">@location.ClinicName</div>
                                                </div>
                                                <div class="span12 doc-div-min-height margin-null">
                                                    <div class="left loc-label doc-div-min-height span4">City:</div>
                                                    <div class="span7 doc-div-min-height left doc-detail-word-break">@location.City</div>
                                                </div>
                                                <div class="span12 doc-div-min-height margin-null">
                                                    <div class="left loc-label doc-div-min-height span4">Location:</div>
                                                    <div class="span7 doc-div-min-height left doc-detail-word-break">@location.Location</div>
                                                </div>
                                                <div class="span12 doc-div-min-height margin-null">
                                                    <div class="left loc-label doc-div-min-height span4">Address:</div>
                                                    <div class="span7 doc-div-min-height left doc-detail-word-break">@location.Address</div>
                                                </div>
                                                <div class="span12 doc-div-min-height margin-null">
                                                    <div class="left loc-label doc-div-min-height span4">Phone:</div>
                                                    <div class="span7 doc-div-min-height left doc-detail-word-break">@location.Telephone</div>
                                                </div>
                                            </div>
                                            if (count != Model.locations.Count)
                                            {
                                                <br /> <hr class="doc-details-hr" />
                                            }
                                        }
                                        else
                                        {
                                            <div class="span5 border-color-doc-details left doc-clinic-container" style="margin-left: 0;">
                                                <div class="span12 doc-div-min-height margin-null">
                                                    <div class="left loc-label doc-div-min-height span4">Clinic Name:</div>
                                                    <div class=" span7 doc-div-min-height left doc-detail-word-break">@location.ClinicName</div>
                                                </div>
                                                <div class="span12 doc-div-min-height margin-null">
                                                    <div class="left loc-label doc-div-min-height span4">City:</div>
                                                    <div class="span7 doc-div-min-height left doc-detail-word-break">@location.City</div>
                                                </div>
                                                <div class="span12 doc-div-min-height margin-null">
                                                    <div class="left loc-label doc-div-min-height span4">Location:</div>
                                                    <div class="span7 doc-div-min-height left doc-detail-word-break">@location.Location</div>
                                                </div>
                                                <div class="span12 doc-div-min-height margin-null">
                                                    <div class="left loc-label doc-div-min-height span4">Address:</div>
                                                    <div class="span7 doc-div-min-height left doc-detail-word-break">@location.Address</div>
                                                </div>
                                                <div class="span12 doc-div-min-height margin-null">
                                                    <div class="left loc-label doc-div-min-height span4">Phone:</div>
                                                    <div class="span7 doc-div-min-height left doc-detail-word-break">@location.Telephone</div>
                                                </div>
                                            </div>
                                        }
                                        count++;
                                    }
                                    <hr class="doc-details-hr" />
                                </div>
                            }
                        </div>
                    </div>
                    }
                </div>
                @if (Model.locations != null && Model.locations.Count > 0)
                {
                    <div class="row-fluid visible-phone">
                        <div class="span6 ">
                            <div id="ClinicName" class="span5 doc-clinic-container cust-below-space-reduce doc-clinic-details cust-space-above">
                                CLINIC/ HOSPITAL ADDRESS DETAILS:
                            </div>
                            @if (Convert.ToBoolean(Model.IsDocConnectUser))
                            {
                                <div class="span6 visible-phone">
                                    <a class='pull-left btn book_appt_button' href='@Convert.ToString(ConfigurationSettings.AppSettings["DocConnectApptUrl"])@Utilities.Encrypt(Convert.ToString(Model.UserId).Trim())&frmaskmirai=1' target='_blank' onclick='bookaptclicked( "@Utilities.Encrypt(Convert.ToString(Model.UserId))")'>Book Appointment </a>
                                </div>
                            }
                            @if (Convert.ToBoolean(Model.IsDocConnectUser) == false)
                            {
                                <div class="span6 visible-phone">
                                    <a class='pull-left btn book_appt_button' onclick="ViewProfile(@Model.UserId)">Book Appointment </a>
                                </div>
                            }
                        </div>
                    </div>
                    <div class="row-fluid visible-phone">
                        <div class="span9">
                            @if (Model.locations != null && Model.locations.Count > 0)
                            {
                                int count = 1;
                                <div class="row">
                                    @foreach (var location in Model.locations)
                                    {
                                        if (count % 2 == 0)
                                        {
                                            <div class="span5 left doc-clinic-container">
                                                <div class="span12 doc-div-min-height margin-null">
                                                    <div class="left loc-label doc-div-min-height span4">Clinic Name:</div>
                                                    <div class="span7 doc-div-min-height left doc-detail-word-break">@location.ClinicName</div>
                                                </div>
                                                <div class="span12 doc-div-min-height margin-null">
                                                    <div class="left loc-label doc-div-min-height span4">City:</div>
                                                    <div class="span7 doc-div-min-height left doc-detail-word-break">@location.City</div>
                                                </div>
                                                <div class="span12 doc-div-min-height margin-null">
                                                    <div class="left loc-label doc-div-min-height span4">Location:</div>
                                                    <div class="span7 doc-div-min-height left doc-detail-word-break">@location.Location</div>
                                                </div>
                                                <div class="span12 doc-div-min-height margin-null">
                                                    <div class="left loc-label doc-div-min-height span4">Address:</div>
                                                    <div class="span7 doc-div-min-height left doc-detail-word-break">@location.Address</div>
                                                </div>
                                                <div class="span12 doc-div-min-height margin-null">
                                                    <div class="left loc-label doc-div-min-height span4">Phone:</div>
                                                    <div class="span7 doc-div-min-height left doc-detail-word-break">@location.Telephone</div>
                                                </div>
                                            </div>
                                            if (count != Model.locations.Count)
                                            {
                                                 <hr class="doc-details-hr" />
                                            }
                                        }
                                        else
                                        {
                                            <div class="span5 border-color-doc-details left doc-clinic-container">
                                                <div class="span12 doc-div-min-height margin-null">
                                                    <div class="left loc-label doc-div-min-height span4">Clinic Name:</div>
                                                    <div class=" span7 doc-div-min-height left doc-detail-word-break">@location.ClinicName</div>
                                                </div>
                                                <div class="span12 doc-div-min-height margin-null">
                                                    <div class="left loc-label doc-div-min-height span4">City:</div>
                                                    <div class="span7 doc-div-min-height left doc-detail-word-break">@location.City</div>
                                                </div>
                                                <div class="span12 doc-div-min-height margin-null">
                                                    <div class="left loc-label doc-div-min-height span4">Location:</div>
                                                    <div class="span7 doc-div-min-height left doc-detail-word-break">@location.Location</div>
                                                </div>
                                                <div class="span12 doc-div-min-height margin-null">
                                                    <div class="left loc-label doc-div-min-height span4">Address:</div>
                                                    <div class="span7 doc-div-min-height left doc-detail-word-break">@location.Address</div>
                                                </div>
                                                <div class="span12 doc-div-min-height margin-null">
                                                    <div class="left loc-label doc-div-min-height span4">Phone:</div>
                                                    <div class="span7 doc-div-min-height left doc-detail-word-break">@location.Telephone</div>
                                                </div>
                                            </div>
                                            if (count != Model.locations.Count)
                                            {
                                                <hr class="doc-details-hr" />
                                            }
                                        }
                                        count++;
                                    }
                                    <hr class="doc-details-hr" />
                                </div>
                            }
                        </div>
                    </div>
                }
                @if ((Model.specialities != null && Model.specialities.Count > 0) || (Model.details != null && Model.details.Count > 0) || (Model.details != null && Model.details.Count > 0))
                {
                    <div class="row-fluid hidden-phone">
                        <div class="span2 hidden-phone">
                        </div>
                        <div class="span9">
                            <div class="row">
                                <div id="OtherDetails" class="span5  doc-clinic-container doc-clinic-details cust-below-space-reduce">OTHER DETAILS:</div>
                            </div>
                        </div>
                    </div>
                    <div class="row-fluid visible-phone">
                        <div class="row-fluid visible-phone">
                            <div class="span6 visible-phone">
                                <div id="ClinicName" class="span5 doc-clinic-details cust-below-space-reduce visible-phone">
                                    OTHER DETAILS:
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row-fluid">
                        <div class="span2 hidden-phone">
                        </div>
                        <div class="span9">
                            <div class="row">
                                <div id="OtherDetailsDiv" class="span5 border-color-doc-details margin-left-null">
                                    <div style="margin-bottom:15px">
                                        @if (Model.specialities != null && Model.specialities.Count > 0)
                                        {
                                            <div><span class="left loc-label">Specialities:</span></div>
                                            foreach (var speciality in Model.specialities)
                                            {
                                                if (!String.IsNullOrEmpty(speciality.Speciality))
                                                {
                                                    <div>
                                                        <span class="left">@(speciality.Speciality)</span>
                                                    </div>
                                                }
                                            }
                                        }
                                    </div>
                                    <div>
                                        @if (Model.details != null && Model.details.Count > 0)
                                        {
                                            if (Model.details.Where(x => x.Certification != null).Count() > 0)
                                            {
                                                <div><span class="left loc-label">Award/Recognition:</span></div>
                                            }
                                            foreach (var detail in Model.details)
                                            {
                                                if (!String.IsNullOrEmpty(detail.Certification))
                                                {
                                                    <div>
                                                        <span class="left">@(detail.Certification)</span>
                                                    </div>
                                                }
                                            }

                                        }
                                    </div>
                                </div>
                                <div class="span5">
                                    @if (Model.qualification != null && Model.qualification.Count > 0)
                                    {
                                        <div><span class="left loc-label">Education:</span></div>
                                        foreach (var q in Model.qualification)
                                        {
                                            if (!String.IsNullOrEmpty(q.Degree))
                                            {
                                                <div>
                                                    <span class="left">@(q.Degree)</span>
                                                </div>
                                            }
                                        }
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                }
                <div class="row-fluid">
                    <hr class="doc-details-hr" />
                    @if (Convert.ToInt32(ViewBag.isConsult) != 1)
                    {
                        <div class="doc-clinic-details" style="margin-bottom:15px">Mirai Consult activity</div>
                        <div id="feed" class="margin_bottom"></div>
                        <input type="hidden" id="HdnUserID" name="HdnUserID" value="@Model.UserId" />
                        <input type="hidden" id="HdnRecordSize" name="HdnRecordSize" value="@(ConfigurationManager.AppSettings["NumberOfRecored"].ToString())" />
                        <input type="hidden" id="HdnUserFullName" name="HdnUserFullName" value="@(Model.FirstName+" "+Model.LastName)" />
                        <input type="hidden" id="FacebookAppKey" name="FacebookAppKey" value="@(Convert.ToString(ConfigurationSettings.AppSettings["FacebookAppKey"]))" />
                        <input type="hidden" id="AskmiraiUrl" name="AskmiraiUrl" value="@(Convert.ToString(ConfigurationSettings.AppSettings["askMiraiLink"]))" />
                        <input type="hidden" id="HiddenUserType" name="HiddenUserType" value="@ViewBag.UserType" />
                    }
                    else
                    {
                        <div class="row-fluid">
                            <div class="center_align"><span>9922556699</span></div>
                        </div>
                    }
                </div>
            </div>
        </div>
        @if (Convert.ToInt32(ViewBag.isConsult) != 1)
        {
            <div style="text-align: center" id="loadingImage">
                <img alt="Data Loading.." src="~/Content/image/ajax_loader.gif" style="width: 50px" />
            </div>
        }
    </div>
    <script src="~/Content/js/utility.js"></script>
    <script type="text/javascript" src="https://connect.facebook.net/en_US/all.js"></script>
    <script type="text/javascript">
        var indexoF;
        $(function () {
            @if (!(Model.locations != null && Model.locations.Count > 0))
            {
                @:$("#ClinicName").css("display", "none");
                                    }
            @if (!(Model.qualification != null && Model.qualification.Count > 0) && !(Model.details != null && Model.details.Count > 0) && !(Model.specialities != null && Model.specialities.Count > 0))
            {
                @:$("#OtherDetails").css("display", "none");
                @:$("#OtherDetailsDiv").css("border", "none");
            }
            @if (Convert.ToInt32(ViewBag.isConsult) != 1)
            {
                @: indexoF = 0;
                @: populateFeedData(indexoF, false);
                @:});
                @:$(window).scroll(function () {
                @:if ($(window).scrollTop() >= $(document).height() - $(window).height() - 10) {
                @:   indexoF = parseInt(indexoF) + 5
                @:  populateFeedData(indexoF, true)
                @:}
            }
        });
        function populateFeedData(index) {
            var RecordSize = document.getElementById("HdnRecordSize").value;
            var UserId = document.getElementById("HdnUserID").value;
            var UserFullName = document.getElementById("HdnUserFullName").value;
            var urladdress = "../Services/UserService.svc/getFeedList?lastQuestionNo=" + index + "&RecordSize=" + RecordSize + "&UserId=" + UserId + "&myFeed=" + 1 + "&isEncrypt=false";
            $.ajax({
                type: 'GET',
                dataType: 'json',
                url: urladdress,
                success: function (response) {
                    var Question = 0;
                    response = JSON.parse(response);
                    for (indexcnt = 0; indexcnt < response.length; indexcnt++) {
                        var UserId = document.getElementById("HdnUserID").value, ansimg = '';
                        if (response[indexcnt].doctorimg && response[indexcnt].doctorimg)
                            var img = response[indexcnt].photourl + escape(response[indexcnt].doctorimg);
                        else
                            var img = "../Content/image/img-na.png";
                        if (response[indexcnt].answerimg)
                            var ansimg = "../feed/answerPhotos/" + escape(response[indexcnt].answerimg);
                        var template;
                        var thanxcount = response[indexcnt].endorsecount;
                        var answerid = response[indexcnt].answerid;
                        var title;
                        if (response[indexcnt].title != null)
                            title = response[indexcnt].title;
                        else
                            title = "";
                        template = "<div class='span12 custom-yellow-container' ><div class='custom-inner-green-container'><a class='question_text' href='../answers/" + response[indexcnt].questionid + "'>" + response[indexcnt].questiontext + "</a></div> <div id=" + answerid + "ans>" +
                        "<div class='inner-count-likes pull-right' title='Thanked by patient'>" + response[indexcnt].thanxcount + "</div><div class='inner-count-endorse pull-right' title='Endorsed'> " + response[indexcnt].endorsecount + "</div><div></div></div></div><div class='row-fluid'>" +
                        "<div class='span5'><div class='title_text'>" + title + "</div></div></div><div class='row-fluid'>";
                        if (ansimg.length > 0) {
                            template = template + "<div class='span5'><p class='ans_text' style='word-wrap: break-word;'>" + response[indexcnt].answertext + "</p></div><div class='span3'><div class=''><div class='feedAnsImage img'><img src=" + ansimg + "></div></div></div></div>";
                        }
                        else {
                            template = template + "<div class='span11'><p class='ans_text' style='word-wrap: break-word;'>" + response[indexcnt].answertext + "</p></div>";
                        }
                        if (document.getElementById("HiddenUserType").value != "0" && document.getElementById("HiddenUserType").value != '') {
                            var url = document.getElementById("AskmiraiUrl").value;
                            var FBappkey = document.getElementById("FacebookAppKey").value;
                            template = template + "<div class='row-fluid margintop_tosharebutn'>" +
                            "<div class='pull-right' style='width:100%'><div class='top_marging_sharelink'><div class='hidden-phone span9'><hr style='margin:15px;'></div><a href='#' onclick='shareOnFacebook(\"" + escape(response[indexcnt].questiontext) + "\",\"" + escape(response[indexcnt].answertext) + "\", \"" + escape(response[indexcnt].questionid) + "\",\"" + url.toString() + "\",\"" + FBappkey.toString() + "\", \"Doctor\")'><img title='Facebook' class='share_icons_width' src='../Content/image/fb.png' alt='Facebook'></a>" +

                            "<a class='share_link-margin ' target='_blank'  href='https://twitter.com/intent/tweet?button_hashtag=TwitterStories&text= " + url.toString() + "/answers/" + escape(response[indexcnt].questionid) + "' onclick='ga(\"send\", \"event\", \"Doctor\", \"Share On Twitter\", \"" + response[indexcnt].questiontext + "\")'><img title='Twitter' class='share_icons_width' src='../Content/image/twitter.png' alt='Twitter'></a>" +
                            //"<a class='share_link-margin ' target='_blank'  href='https://twitter.com/intent/tweet?button_hashtag=TwitterStories&text= Q. " + escape(response[indexcnt].questiontext) + " \n Ans. " + escape(response[indexcnt].answertext) + " \n " + url.toString() + "/Patients/PatientQuestionDetails/" + escape(response[indexcnt].questionid) + "'><img title='Twitter' class='share_icons_width' src='../Resources/image/twitter.png' alt='Twitter'></a>" +
                            "<a class='share_link-margin ' target='' href='mailto:?Subject=Mirai Consult has shared an answer with you &amp;Body= Q. " + escape(response[indexcnt].questiontext) + " %0D%0A  Ans. " + escape(response[indexcnt].answertext) + "' style='margin-right:10px'  onclick='ga(\"send\", \"event\", \"Doctor\", \"Share on Email\", \"" + response[indexcnt].questiontext + "\")'><img title='Email' class='share_icons_width' src='../Content/image/mail.png' alt='Email'></a>";
                        }
                        if (UserId != response[indexcnt].docid) {
                            if (response[indexcnt].isendorse) {
                                template = template.concat("<a class='custom-green-text'><img src='../Content/image/thanks.png'/>Endorsed</a>");
                            }
                            else {
                                var QuestionText = response[indexcnt].questiontext.replace(/\s{2,}/g, ' ');
                                template = template.concat("<a class=\"custom-link\" onclick=\"return endorseToDoctor(" + UserId + "," + response[indexcnt].answerid + ",this,'" + response[indexcnt].docLastname + "','" + response[indexcnt].docmobileno + "','" + response[indexcnt].doctEmail + "','" + UserFullName + "','" + escape(QuestionText) + "','" + response[indexcnt].endorsecount + "')\"><b>Want to endorse?</b></a>")
                            }
                        }
                        template = template.concat("</div></div></div><div class='visible-phone row-fluid'><br/></div>")
                        $("#feed").append(template);
                        Question++;
                    }
                    if (Question < 3) {
                        document.getElementById("loadingImage").style.visibility = "hidden"
                    }
                    if (response.length == 0 && $("#feed").html().length == 0) {
                        $('#feed')[0].innerHTML = 'No records found';
                    }
                },
                error: function () {
                }
            });
        }
    </script>
}