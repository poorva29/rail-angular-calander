@model MiraiConsultMVC.Models.Feed
@{
    ViewBag.Title = "DoctorFeed";
    Layout = "~/Views/Shared/_PatientMasterLayout.cshtml";
}
@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()
    @Html.ValidationSummary(true)
    {
     <div class="custom-central-div">
            <div class="row-fluid">
                <div class="span12">
                    <div class="span12 custom-green-container custom-occupy">
                         <label class="span1 hidden-phone " style="padding-top:5px; text-align:right">Filter:</label>
                         <div class="pull-right span11">
                            <label class="radio inline">
                                <input type="radio" clientidmode="Static" id="rdbFilterAllFeed" onchange="onFilterChange(this);" name="Filter" checked />All Feed</label>
                           <label class="radio inline margin_my_feed_redio div-margin-left" style="margin-left:50px;">
                                <input type="radio" clientidmode="Static" id="radFilterMyFeed" onchange="onFilterChange(this);" name="Filter" />My Feed</label>
                         </div>
                    </div>
                    <div class="row-fluid">
                         <div class=" span12 custom-bottom-border">
                             <div class="cust-Q-title unique_class" id="feedTitle">All feed</div>
                         </div>
                    </div>
                    <div id="feed" class="margin_bottom"></div>
                    
                    <input type="hidden" id="HdnUserID" name="HdnUserID" value="@Model.HdnUserID" />
                    <input type="hidden" id="HdnRecordSize" name="HdnRecordSize" value="@Model.HdnRecordSize" />
                    <input type="hidden" id="HdnUserFullName" name="HdnRecordSize" value="@Model.HdnUserFullName" />
                    <input type="hidden" id="FacebookAppKey" name="FacebookAppKey" value="@Model.FacebookAppKey" />
                    <input type="hidden" id="AskmiraiUrl" name="AskmiraiUrl" value="@Model.AskmiraiUrl" />
                </div>               
            </div>
             <div style="text-align: center" id="loadingImage">
                 <img alt="Data Loading.." src="~/Content/image/ajax_loader.gif" style="width: 50px" />
             </div>
        </div>
   <script type="text/javascript" src="https://connect.facebook.net/en_US/all.js"></script>
   <script type="text/javascript" src="~/Content/js/utility.js"></script>

    <script type="text/javascript">
        var indexoF;
        $(function () {
            $(".navigation li.active").removeClass("active");
            $('#liDocFeed').addClass("active");
            indexoF = 0;
            populateFeedData(indexoF, false);
        });
        $(window).scroll(function () {
            if ($(window).scrollTop() >= $(document).height() - $(window).height() - 10) {
                indexoF = parseInt(indexoF) + 5
                if ($("#rdbFilterAllFeed").val() == "rdbFilterAllFeed") {
                    populateFeedData(indexoF, false)
                }
                else {
                    populateFeedData(indexoF, true)
                }
            }
        });
        function onFilterChange(selectedBtn) {
            indexoF = 0;
            $("#feed").empty();
            populateFeedData(indexoF);
            if (selectedBtn.value == 'rdbFilterAllFeed')
                $('.unique_class').html("All Feed");
            else
                $('.unique_class').html("My Feed");

        }
        function populateFeedData(index) {
            var RecordSize = document.getElementById("HdnRecordSize").value;
            var UserId = document.getElementById("HdnUserID").value;
            var UserFullName = document.getElementById("HdnUserFullName").value;
            var urladdress = '';
            if (document.getElementById('radFilterMyFeed').checked) {
                urladdress = "../Services/UserService.svc/getFeedList?lastQuestionNo=" + index + "&RecordSize=" + RecordSize + "&UserId=" + UserId + "&myFeed=" + 1 + "&isEncrypt=false" ;
            }
            else {
                urladdress = "../Services/UserService.svc/getFeedList?lastQuestionNo=" + index + "&RecordSize=" + RecordSize + "&UserId=" + UserId + "&myFeed=" + 0 + "&isEncrypt=false";
            }
            $.ajax({
                type: 'GET',
                dataType: 'json',
                url: urladdress,
                success: function (response) {
                    var Question = 0;
                    response = JSON.parse(response);
                    for (indexcnt = 0; indexcnt < response.length; indexcnt++) {
                        var UserId = document.getElementById("HdnUserID").value, ansimg = '';
                        if (response[indexcnt].doctorimg)
                            var img = response[indexcnt].photourl + escape(response[indexcnt].doctorimg);
                        else
                            var img = "../Content/image/img-na.png";
                        if (response[indexcnt].answerimg)
                            var ansimg = "../feed/answerPhotos/" + escape(response[indexcnt].answerimg);
                        var template;
                        var thanxcount = response[indexcnt].endorsecount;
                        var answerid = response[indexcnt].answerid;
                        var title;
                        if (response[indexcnt].title != null)
                            title = response[indexcnt].title;
                        else
                            title = "";
                        template = "<div class='span12 custom-yellow-container' ><div class='custom-inner-green-container'><a class='question_text' href='../answers/" + response[indexcnt].questionid + "'>" + response[indexcnt].questiontext + "</a></div> <div id=" + answerid + "ans>" +
                        "<div class='inner-count-likes pull-right' title='Thanked by patient'>" + response[indexcnt].thanxcount + "</div><div class='inner-count-endorse pull-right' title='Endorsed'> " + response[indexcnt].endorsecount + "</div><div></div></div></div><div class='row-fluid'>" +
                        "<div class='span1 hidden-phone'><div class='center_align'><div class='feedDocImage img'><img src=" + img + "></div></div></div><div class='feedDocImage img visible-phone'><img src=" + img + "></div><div class='span6 middle-size-padding'><div class='ans_time_detail'>Dr. " + response[indexcnt].answerreplyedby + " </div><div class='title_text'>" + title + "</div></div></div><div class='row-fluid'>";
                        if (ansimg.length > 0) {
                            template = template + "<div class='span5'><p class='ans_text' style='word-wrap: break-word;'>" + response[indexcnt].answertext + "</p></div><div class='span3'><div class=''><div class='feedAnsImage img'><img src=" + ansimg + "></div></div></div></div>";
                        }
                        else {
                            template = template + "<div class='span11'><p class='ans_text' style='word-wrap: break-word;'>" + response[indexcnt].answertext + "</p></div>";
                        }
                        var url = document.getElementById("AskmiraiUrl").value;
                        var FBappkey = document.getElementById("FacebookAppKey").value;
                        template = template + "<div class='row-fluid margintop_tosharebutn'>" +
                        "<div class='pull-right' style='width:100%'><div class='top_marging_sharelink'><div class='hidden-phone span9'><hr style='margin:15px;'></div><a href='#' onclick='shareOnFacebook(\"" + escape(response[indexcnt].questiontext) + "\",\"" + escape(response[indexcnt].answertext) + "\", \"" + escape(response[indexcnt].questionid) + "\",\"" + url.toString() + "\",\"" + FBappkey.toString() + "\")'><img title='Facebook' class='share_icons_width' src='../Content/image/fb.png' alt='Facebook'></a>" +

                        "<a class='share_link-margin ' target='_blank'  href='https://twitter.com/intent/tweet?button_hashtag=TwitterStories&text= " + url.toString() + "/answers/" + escape(response[indexcnt].questionid) + "'><img title='Twitter' class='share_icons_width' src='../Content/image/twitter.png' alt='Twitter'></a>" +
                        //"<a class='share_link-margin ' target='_blank'  href='https://twitter.com/intent/tweet?button_hashtag=TwitterStories&text= Q. " + escape(response[indexcnt].questiontext) + " \n Ans. " + escape(response[indexcnt].answertext) + " \n " + url.toString() + "/Patients/PatientQuestionDetails/" + escape(response[indexcnt].questionid) + "'><img title='Twitter' class='share_icons_width' src='../Resources/image/twitter.png' alt='Twitter'></a>" +
                        "<a class='share_link-margin ' target='' href='mailto:?Subject=Mirai Consult has been shared an Answer with you &amp;Body= Q. " + escape(response[indexcnt].questiontext) + " %0D%0A  Ans. " + escape(response[indexcnt].answertext) + "' style='margin-right:10px'><img title='Email' class='share_icons_width' src='../Content/image/mail.png' alt='Email'></a>";

              
                        if (UserId != response[indexcnt].docid) {
                            if (response[indexcnt].isendorse) {
                                template = template.concat("<a class='custom-green-text'><img src='../Content/image/thanks.png'/>Endorsed</a>");
                            }
                            else {
                                var QuestionText = response[indexcnt].questiontext.replace(/\s{2,}/g, ' ');
                                template = template.concat("<a class=\"custom-link\" onclick=\"return endorseToDoctor(" + UserId + "," + response[indexcnt].answerid + ",this,'" + response[indexcnt].docLastname + "','" + response[indexcnt].docmobileno + "','" + response[indexcnt].doctEmail + "','" + UserFullName + "','" + escape(QuestionText) + "','" + response[indexcnt].endorsecount + "')\"><b>Want to endorse?</b></a>")                               
                            }
                        }
                        template = template.concat("</div></div></div><div class='visible-phone row-fluid'><br/></div>")
                            $("#feed").append(template);
                            Question++;
                        }
                        if (Question < 3) {
                            document.getElementById("loadingImage").style.visibility = "hidden"
                        }
                        if (response.length == 0 && $("#feed").html().length == 0) {
                            $('#feed')[0].innerHTML = 'No records found';
                        }
                },
                error: function () {
                }
            });
        }
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date(); a = s.createElement(o),
            m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
        })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-48132984-2', 'askmirai.com');
        ga('send', 'pageview');
    </script>
    
    
    }
}