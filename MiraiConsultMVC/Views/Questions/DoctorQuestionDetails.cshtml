@model IEnumerable<QuestionDtlModel>
@{
    ViewBag.Title = "DoctorQuestionDetails";
    Layout = "~/Views/Shared/_PatientMasterLayout.cshtml";
}

<script type="text/javascript" src="~/Content/js/utility.js"></script>
@using (Html.BeginForm(Html.BeginForm("DoctorQuestionDetails", "Questions", FormMethod.Post, new { @encType = "multipart/form-data", autocomplete = "off" })))
{
    @Html.AntiForgeryToken()
    @Html.ValidationSummary(true)
    {
        <div class="row-fluid">
            <div class=" custom-central-div">
                <div class="span12">
                    @if (Model != null && Model.Count() != 0)
                    {
                        <div class='span12 custom-green-container'>
                            <div class='question_text'>@Model.FirstOrDefault().QuestionText</div>
                        </div>
                        <br />
                        if (@Model.FirstOrDefault().AnswerId != null)
                        {
                            foreach (var item in Model)
                            {
                                if (@item.Doctor != null)
                                {
                                    <div class="row-fluid">
                                        <div class="span1 question_detail hidden-phone">
                                            <div class="feedDocImage img">
                                                @if (!String.IsNullOrEmpty(item.DoctorImg))
                                                {
                                                    <img src='@(item.DoctorImg)' alt="" />
                                                }
                                                else
                                                {
                                                    <img src="../Content/image/img-na.png" />
                                                }
                                            </div>
                                        </div>
                                        <div class='feedDocImage img visible-phone'>
                                            @if (!String.IsNullOrEmpty(item.DoctorImg))
                                            {
                                                <img src='@(item.DoctorImg)' alt="" />
                                            }
                                            else
                                            {
                                                <img src="../Content/image/img-na.png" />
                                            }
                                        </div>
                                        <div class='span8'>
                                            <div class='ans_time_detail intermediate-size-padding'>Dr. @item.Doctor </div>
                                            <div class='title_text intermediate-size-padding'>
                                                @item.Title
                                            </div>
                                        </div>
                                        <div class="span3">
                                            <div id='@(item.AnswerId)ans'><div class="inner-count-likes pull-right" title="Thanked by patient"> @item.ThanxCount </div><div class="inner-count-endorse pull-right" title="Endorsed">@item.EndorseCount</div></div>
                                        </div>
                                    </div>

                                    <div class='row-fluid'>
                                        @if (!String.IsNullOrEmpty(item.AnswerImg))
                                        {
                                            <div class='span5 offset1'>
                                                <p class='ans_text'>@item.AnswerText</p>
                                            </div>
                                            <div class='span3'>
                                                <div class='feedAnsImage img'>
                                                    <img src='../feed/answerPhotos/@(item.AnswerImg)'>
                                                </div>
                                            </div>
                                        }
                                        else
                                        {
                                            <div class='span11 offset1'>
                                                <p class='ans_text'>@item.AnswerText</p>
                                            </div>
                                        }
                                    </div>
                                    if (Convert.ToInt32(Session["UserId"]) != Convert.ToInt32(item.DocId))
                                    {
                                        <div class='row-fluid'>
                                            <div style="width:100%">
                                                <div class='span10 hidden-phone'><hr style="margin:15px" /></div>
                                                @{bool isendorse;
                                                isendorse = Convert.ToBoolean(item.IsEndorse);
                                                if (!isendorse)
                                                {
                                                    if (Session["UserId"] != null && Session["UserFullName"] != null && !String.IsNullOrEmpty(Convert.ToString(item.AnswerId)) && !String.IsNullOrEmpty(item.LastName) && !String.IsNullOrEmpty(item.MobileNo) && !String.IsNullOrEmpty(item.Email) && !String.IsNullOrEmpty(item.QuestionText) && !String.IsNullOrEmpty(Convert.ToString(item.EndorseCount)))//UserFullName is in questiontext endorsecount
                                                    {
                                                        //<a class='custom-link' onclick='return endorseToDoctor(" <%=  Session["UserId"] %> ","  <%=  QuestionDetails.Tables[0].Rows[i]["answerid"] %>   ",this,"  <%=  QuestionDetails.Tables[0].Rows[i]["lastname"] %>"," <%=  QuestionDetails.Tables[0].Rows[i]["mobileno"] %>  ","<%=  QuestionDetails.Tables[0].Rows[i]["Email"] %>"," <%=  Session["UserFullName"] %> ","<%=  QuestionDetails.Tables[0].Rows[i]["questiontext"] %>","<%=  QuestionDetails.Tables[0].Rows[i]["endorsecount"] %>")'><b>Want to endorse?</b></a>
                                                        <a class='custom-link' onclick="return endorseToDoctor(@(Convert.ToInt32(Session["UserId"])),'@(item.AnswerId)',@("this"),' @(item.LastName)','@(item.MobileNo)','@(item.Email)','@(Session["UserFullName"])','@(item.QuestionText)','@(item.EndorseCount)')"><b>Want to endorse?</b></a>
                                                    }
                                                }
                                                else
                                                {
                                                    <a class="custom-green-text"><img src='../Content/image/thanks.png' />Endorsed</a>
                                                }
                                                }
                                            </div>
                                        </div>
                                    }
                                    if (Model.LastOrDefault() != item)
                                    {
                                        <hr class='hr_color' />
                                    }
                                }
                                if (@item.Doctor == null)
                                {
                                    <div class="span12">No answers received</div>
                                    <br />
                                }
                            }
                        }
                        else
                        {
                            <div class="span12">No answers received</div>
                            <br />
                        }
                    }
                    else
                    {
                        <div class="span12">No records found</div>
                        <br />
                    }
                    @if (ViewBag.lblSuccessMessage == "Thank you for answering the question.")
                    {
                        <div class="wrapper-bordered" id="SuccessMessagediv">
                            <div class="row-fluid">
                                <div class="span12 alert alert-success">
                                    <label class="msg_font success_message_color">@ViewBag.lblSuccessMessage</label>
                                </div>
                            </div>
                        </div>
                    }
                    else
                    {
                        QuestionDtlModel qd = new QuestionDtlModel();
                        qd.DocId = Convert.ToInt32(Session["userid"]);
                        if ((Model.Count() == 0) || Model.ToList()[0].DocId == 0 || Model.ToList().Where(x => x.DocId == qd.DocId).ToList().Count() == 0)
                        {
                            <div id="answer_container" class="offset2 span7 ">
                                <div class=" custom-green-container">
                                    <div class="row-fluid">
                                        <div class="span12">
                                        </div>
                                    </div>
                                    <br />
                                    <div class="row-fluid ">
                                        <label class="pull-left span4 btn-padding-left">Title:</label>
                                        <div class="pull-right span8 main-outter-padding">
                                            <input type="text" name="Title" class="input-block-level" maxlength="50" placeholder="Title" />
                                        </div>
                                    </div>
                                    <br />
                                    <div class="row-fluid">
                                        <label class="pull-left span4 required  btn-padding-left">Answer:</label>
                                        <div class="pull-right span8  main-outter-padding">
                                            <div>
                                                <textarea class="input-block-level txtareaborder" maxlength="500" id="txtAnswer" name="AnswerText" onkeyup="Count(this)" placeholder="Enter Your Answer Here." clientidmode="Static" runat="server" rows="3" cols="10"></textarea>
                                                <label id="count" style="float:right">0/500</label>

                                            </div>
                                            <div><label id="lblErrortxtAnswer" style="color:red"></label></div>
                                        </div>
                                    </div>
                                    <br />
                                    <div class="row-fluid">
                                        <label class="pull-left span4  btn-padding-left">Upload Image:</label>
                                        <div class="pull-right span8  main-outter-padding">
                                            <input type="file" name="AnswerImg" id="Image" value="AnswerImg" maxlength="256" style="width: 100%;" class="fileupload_btn_margin"><br />
                                            <span id="ImageValidation" style="color: red; display: inline;"></span>
                                        </div>
                                    </div>
                                    <br />
                                    <div class="row-fluid">
                                        <div class="span6 offset4 btn-padding-left">
                                            <input type="submit" class="btn thanx" value="Submit" onclick="if (!ValidateAllControl()) return false;">
                                            <input type="reset" class="btn tab_margin cancel gray-border" onclick="window.location.href = window.location.href" value="Reset">
                                        </div>
                                    </div>
                                    <br />
                                </div>
                            </div>
                        }
                    }
                </div>
            </div>
        </div>
        <script type="text/javascript">
            $(function () {
                var refUrl = document.referrer;
                if (refUrl.indexOf("questionlist.aspx") >= 0) {
                    $(".navigation li.active").removeClass("active");
                    $('#liDocQuestions').addClass("active");
                }
            });
            function Count(x) {
                if (x.id == 'txtAnswer')
                    document.getElementById('count').innerHTML = x.value.length + "/500";
            }

            function validatePhoto(sender, args) {
                var file = document.getElementById('<%=fileUploadForImage.ClientID%>');
                var fileName = file.value;
                var lastDot = fileName.lastIndexOf(".");
                if (fileName.length > 0) {
                    var fileType = fileName.substring(lastDot, fileName.length);
                    args.IsValid = (((fileType.toLowerCase() == ".jpg") || (fileType.toLowerCase() == ".png") || (fileType.toLowerCase() == ".gif") || (fileType.toLowerCase() == ".jpeg")));
                }
            }

            $("input[type=submit]").click(function () {
                var val = $("#ImageValidation").text();
                tryNumber = 0;
                if (val == "") {
                    return true;
                }
                else {
                    return false;
                }
            });

            $("#Image").change(function () {
                var val = $(this).val();
                if(val.trim()!= ""){
                switch (val.substring(val.lastIndexOf('.') + 1).toLowerCase()) {
                    case 'gif': case 'jpg': case 'png': case 'jpeg':
                        $("#ImageValidation").html("");
                        break;
                    default:
                        $("#ImageValidation").html("Supports only .jpg,.png,.gif,.jpeg formats. Please upload a file with either of these extensions.");
                        break;
                }
                }
            });

            function ValidateAllControl() {
                var errormsg = "";
                if ($("#txtAnswer").val() == "") {
                    errormsg += "Please Enter Answer.";
                    $("#lblErrortxtAnswer").html("Please Enter Answer.");
                }
                if (errormsg == "") {
                    return true;
                }
                else {
                    return false;
                }
            }
            $("#txtAnswer").keypress(function (e) {
                var lengthF = $(this).val();

                if (lengthF.length > 499){
                    e.preventDefault();
                }
                $("#lblErrortxtAnswer").html('');
            });
            (function (i, s, o, g, r, a, m) {
                i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
                    (i[r].q = i[r].q || []).push(arguments)
                }, i[r].l = 1 * new Date(); a = s.createElement(o),
                m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
            })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

            ga('create', 'UA-48132984-2', 'askmirai.com');
            ga('send', 'pageview');
        </script>
    }
}