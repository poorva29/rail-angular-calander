@model IList<ModelUser>
@{
    Layout = "~/Views/Shared/_PatientMasterLayout.cshtml";        
}
<script src="~/Content/js/jquery-1.9.1.min.js"></script>
<script src="~/Content/js/jquery.dataTables.js"></script>
<script src="~/Content/js/bootstrap-pagination.js"></script>
<div class="row-fluid div_margin_bottom">
    <div class="span12 main-outter-padding">
        <div class="row-fluid">
            <div class="span12 finddoc-title">
                Manage Doctors
            </div>
        </div>
        <div class="main row-fluid">
            <div class="span12">
                <div class="">
                    <div class="row-fluid registerDoctor">
                        <div class="row-fluid filter-div btn-padding-left">
                            @using (Ajax.BeginForm("ManageDoctors", new AjaxOptions
                                    {
                                        HttpMethod = "get",
                                        InsertionMode = InsertionMode.Replace,
                                        UpdateTargetId = "AllDoctorDetails",
                                        LoadingElementId = "DoctorDetailForm"
                                    }))
                            {
                                <div class="span1">
                                    <b>Filter:</b>
                                </div>
                                <div class="span3">
                                    <input id="ChkRegisteredhdn" name="Registered" type="hidden" />
                                    <input id="ChkRegistered"  type="checkbox"  />
                                    <label class="checkbox chk_box_inline">Registered Doctors</label>
                                </div>
                                <div class="span3">
                                    <input id="ChkApprovedhdn" name="Approved" type="hidden" />
                                    <input id="ChkApproved" type="checkbox" />
                                    <label class="checkbox chk_box_inline ">Approved Doctors </label>
                                </div>
                                <div class="span3">
                                    <input id="ChkRejectedhdn" name="Rejected" type="hidden" />
                                    <input id="ChkRejected"  type="checkbox" />
                                    <label class="checkbox chk_box_inline">Rejected Doctors </label>
                                </div>
                            }
                        </div>
                        <div class="row-fluid div_margin_bottom" >
                            <div class="span12">
                                <div class="table-responsive">
                                    <table cellpadding="0" cellspacing="0" border="0" class="custom-table zebra-striped"
                                           id="Doctorlist">
                                        <thead>
                                            <tr>
                                                <th class="table-heading-color">
                                                    <b>Name</b>
                                                </th>
                                                <th class="table-heading-color">
                                                    <b>Registration Date</b>
                                                </th>
                                                <th class="table-heading-color">
                                                    <b>Email ID</b>
                                                </th>
                                                <th class="table-heading-color">
                                                    <b>Specialities</b>
                                                </th>
                                                <th class="table-heading-color">
                                                    <b>Mobile No.</b>
                                                </th>
                                                <th class="table-heading-color">
                                                    <b>Status</b>
                                                </th>
                                                <th class="edit_th_min_width table-heading-color">
                                                    <b>Edit </b>
                                                </th>
                                            </tr>
                                        </thead>
                                        @Html.Partial("_DoctorDetails", Model)
                                    </table>
                                </div>
                            </div>
                        </div>


                    </div>
                            </div>
                        </div>
                    </div>

    </div>
</div>

<script type="text/javascript">
    var responsFlag = 1;
    var ajaxFormSubmit
    $(function () {
         ajaxFormSubmit = function () {
            var $form = $(this);

            var options = {
                url: $form.attr("action"),
                type: $form.attr("data-ajax-method"),
                data: $form.serialize()
            };

            $.ajax(options).done(function (data) {
                var $target = $($form.attr("data-ajax-update"));
                $target.replaceWith(data);
                initDataTable();
            });
            return false;
         };
         $("form[data-ajax='true']").submit(ajaxFormSubmit);
    })
    $(document).on("click", "#ChkRegistered", function () {
       if($('#ChkRegistered').prop('checked')==true){ 
            $('#ChkRegisteredhdn').val("1");
       }
       else{
           $('#ChkRegisteredhdn').val("");
       }
        $('form').submit();
    });

    $(document).on("click", "#ChkApproved", function () {
        if ($('#ChkApproved').prop('checked') == true) {
            $('#ChkApprovedhdn').val("1");
        }
        else {
            $('#ChkApprovedhdn').val("");
        }
        $('form').submit();
    });
    $(document).on("click", "#ChkRejected", function () {
        if ($('#ChkRejected').prop('checked') == true) {
            $('#ChkRejectedhdn').val("1");
        }
        else {
            $('#ChkRejectedhdn').val("");
        }
        $('form').submit();
    });


    function onSuccess(result) {
        alert(result);
        window.location.assign(location.href);
    }
    function onFailure(error) {
        window.location.assign(location.href);
    }
    function approveStatusByDoctorID(doctorid, DoctorMobile, DoctorEmail, DoctorName) {
            if (confirm("Are you sure you want to approve this user?") == true) {
                document.body.style.cursor = 'wait';
                $.ajax({
                    type: 'GET',
                    dataType: 'json',
                    url: "/User/ApproveDoctor?doctorid=" + doctorid + "&DoctorMobile=" + DoctorMobile + "&DoctorName=" + DoctorName+"&DoctorEmail="+DoctorEmail,
                    success: function (response) {
                        if (response == "Doctor has been Approved successfully.") {
                            $('form').submit();
                            alert(response);
                            window.location.reload(true);
                            document.body.style.cursor = 'default';
                        }
                        else if (response == "Unable to change the status.") {
                            alert(response);
                            document.body.style.cursor = 'default';
                        }
                    },
                    error: function () {
                        alert("Error");
                    }
                });
            }
    }
    function rejectStatusByDoctorID(doctorid, DoctorMobile, DoctorEmail) {
        if (confirm("Are you sure you want to reject this user?") == true) {
            document.body.style.cursor = 'wait';
            $.ajax({
                type: 'GET',
                dataType: 'json',
                url: "/User/RejectDoctorByDoctorId?doctorid=" + doctorid + "&DoctorMobile=" + DoctorMobile + "&DoctorEmail=" + DoctorEmail,
                success: function (response) {
                    if (response == "Doctor has been Rejected successfully.") {
                        $('form').submit();
                        alert(response);
                        window.location.reload(true);
                        document.body.style.cursor = 'default';
                    }
                    else if (response == "Unable to change the status.") {
                        alert(response);
                        document.body.style.cursor = 'default';
                    }
                },
                error: function () {
                    alert("Error");
                }
            });
        }
    }
    function showDoctorDetailById(DoctorID) {
        window.location.href = "/doctor-profile/" + DoctorID;
    }
    function EndRequestHandler() {
        initDataTable();
    }
    

    /* Table initialisation */
    function initDataTable() {
        $('#Doctorlist').dataTable({
            "sDom": '<"row-fluid"<"span6"l><"span6"f>r>t<"row-fluid"<"span5"i><"span7"p>>',
            "sPaginationType": "bootstrap",
            "bStateSave": false,
            "bDestroy": true,
            "oLanguage": {
                "sLengthMenu": "_MENU_ records per page"
            },
            // Setup for responsive datatables helper.
            bAutoWidth: false
        });
    }
    $(document).ready(function () {
        $('#ChkApproved').prop('checked', false);
        $('#ChkRejected').prop('checked', false);
        $('#ChkRegistered').prop('checked', false);
        $(".navigation li.active").removeClass("active");
        $('#liManageDoctor').addClass("active");
        initDataTable();
    });

    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date(); a = s.createElement(o),
        m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-48132984-2', 'askmirai.com');
    ga('send', 'pageview');
</script>

